{"ast":null,"code":"import _regeneratorRuntime from\"/home/fabricio7p/Documents/Projects/Ikebana/Frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/fabricio7p/Documents/Projects/Ikebana/Frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/fabricio7p/Documents/Projects/Ikebana/Frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{Link,useHistory,useLocation}from'react-router-dom';import{useSelector,useDispatch}from'react-redux';import{changeUrl}from'store/ducks/links';import{loadNotif}from'store/ducks/notifications';import{refreshAuth}from'store/ducks/auth';import{DebounceInput}from'react-debounce-input';import SettingsDialog from'../aux/SettingsDialog/SettingsDialog';import SearchBox from'../aux/SearchBox/SearchBox';import Modal from'../aux/Modal';import api from'../../services/api';import'./styles.scss';import Clipper from'../aux/Clipper/Clipper';//Page names\nvar Pages={'explore':'Explorar','account':'Conta','home':'Perfil','lessons':'Aulas','lesson':'Aula'};var CurrentUrl=function CurrentUrl(){var active=useLocation();return active.pathname.slice(1).split('/')[0];};export default function Header(){var dispatch=useDispatch();var history=useHistory();//shrink on scroll\nuseEffect(function(){window.onscroll=function(){shrinkOnScroll();};var shrinkOnScroll=function shrinkOnScroll(){if(document.body.scrollTop>80||document.documentElement.scrollTop>80){if(window.location.pathname!=='/motivation'&&window.location.pathname!=='/register'&&window.location.pathname!=='/login'&&window.location.pathname!=='/forgot_pass'&&window.location.pathname!=='/logout'){document.getElementById(\"header_main\").style.height=\"3.5em\";document.getElementById(\"menu_container\").style.top=\"4px\";document.getElementById(\"sidebar_menu\").style.transform=\"translateY(-1.5em)\";}}else{if(window.location.pathname!=='/motivation'&&window.location.pathname!=='/register'&&window.location.pathname!=='/login'&&window.location.pathname!=='/forgot_pass'&&window.location.pathname!=='/logout'){document.getElementById(\"menu_container\").style.top=\"16px\";document.getElementById(\"header_main\").style.height=\"5em\";document.getElementById(\"sidebar_menu\").style.transform=\"translateY(0)\";}}};});//Search\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),search=_useState2[0],setSearch=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),searchBox=_useState4[0],setSearchBox=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),results=_useState6[0],setResults=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),loading=_useState8[0],setLoading=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),loading2=_useState10[0],setLoading2=_useState10[1];var commitSearch=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoading(true);_context.prev=1;_context.next=4;return api({method:'post',url:'/search',data:{'string':search}});case 4:response=_context.sent;setResults(response.data);_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);console.log(_context.t0);case 11:_context.prev=11;setLoading(false);return _context.finish(11);case 14:case\"end\":return _context.stop();}}},_callee,null,[[1,8,11,14]]);}));return function commitSearch(){return _ref.apply(this,arguments);};}();//hamburguer\nvar _useState11=useState(true),_useState12=_slicedToArray(_useState11,2),side=_useState12[0],setSide=_useState12[1];useEffect(function(){window.innerWidth<850&&setSide(false);},[]);var toggleSidebar=function toggleSidebar(){if(window.innerWidth<850){if(side){document.getElementById(\"main_sidebar\").style.transform=\"translateX(-220px)\";document.getElementById(\"side-overlay\").style.display=\"none\";setSide(false);}else{document.getElementById(\"main_sidebar\").style.transform=\"translateX(0px)\";document.getElementById(\"side-overlay\").style.display=\"block\";setSide(true);}}else{if(side){document.getElementById(\"main_sidebar\").style.transform=\"translateX(-220px)\";if(window.location.pathname.includes('explore')){document.getElementsByClassName(\"prev\")[0].style.transform=\"translateX(10px)\";}setSide(false);}else{document.getElementById(\"main_sidebar\").style.transform=\"translateX(0px)\";if(window.location.pathname.includes('explore')){document.getElementsByClassName(\"prev\")[0].style.transform=\"translateX(230px)\";}setSide(true);}}};//Buttons dialog\nvar _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),dialog=_useState14[0],setDialog=_useState14[1];//Buttons counter indicator\nvar cartCount=useSelector(function(state){return state.shop.cart.length;});var allNotif=useSelector(function(state){return state.notifications.notifications;});//Profile button\nvar _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),settings=_useState16[0],setSettings=_useState16[1];//Notif Counter\nvar _useState17=useState(allNotif.length),_useState18=_slicedToArray(_useState17,2),notifCount=_useState18[0],setnotifCount=_useState18[1];//Defaults\nvar defaults=useSelector(function(state){return state.defaults.data;});//Data fetching\nvar _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),data=_useState20[0],setData=_useState20[1];var authKey=useSelector(function(state){return state.auth.keys;});var hitApi=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(key){var response,refresh_key,onExpire,_key;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setLoading2(true);_context2.prev=1;_context2.next=4;return api({method:'get',url:'/user',headers:{'Authorization':\"Bearer \".concat(key[0].key)}});case 4:response=_context2.sent;dispatch(loadNotif(response.data.notifications));setData(response.data);_context2.next=18;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);refresh_key=authKey[0].refresh_key;_context2.next=14;return api({method:'get',url:'/refresh',headers:{'Authorization':\"Bearer \".concat(refresh_key)}});case 14:onExpire=_context2.sent;_key=onExpire.data.key;dispatch(refreshAuth({key:_key,refresh_key:refresh_key}));window.location.reload();case 18:_context2.prev=18;setLoading2(false);return _context2.finish(18);case 21:case\"end\":return _context2.stop();}}},_callee2,null,[[1,9,18,21]]);}));return function hitApi(_x){return _ref2.apply(this,arguments);};}();useEffect(function(){var interval=setInterval(function(){authKey.length!==0&&hitApi(authKey);},100000);return function(){return clearInterval(interval);};},[]);useEffect(function(){authKey.length!==0&&hitApi(authKey);},[]);useEffect(function(){setnotifCount(allNotif.filter(function(value){return value.is_read===false;}).length);});useEffect(function(){search&&commitSearch();},[search]);return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{onClick:toggleSidebar,id:\"side-overlay\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"header-main\",id:\"header_main\"},/*#__PURE__*/React.createElement(\"div\",{className:\"menu-container\",id:\"menu_container\"},/*#__PURE__*/React.createElement(\"button\",{onClick:toggleSidebar,id:\"hamburguer\"},/*#__PURE__*/React.createElement(\"i\",{className:\"material-icons\"},\"menu\")),/*#__PURE__*/React.createElement(\"div\",{className:\"sanguetsu-mark\"},/*#__PURE__*/React.createElement(\"img\",{className:\"header-logo\",src:\"https://ikebana-app-content.s3-sa-east-1.amazonaws.com/static/mainlogo_transparent_notext.png\",alt:\"logo\"}),/*#__PURE__*/React.createElement(\"p\",{className:\"logo-title\"},\"SANGUETSU\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"header-main__content\",id:\"header_title\"},/*#__PURE__*/React.createElement(\"div\",{className:\"header-main__content--title\"},/*#__PURE__*/React.createElement(\"div\",{className:\"title-limiter\"},/*#__PURE__*/React.createElement(\"h1\",{className:\"page-title\",id:\"header_title\"},Pages[CurrentUrl()]))),/*#__PURE__*/React.createElement(\"div\",{className:\"header-main__content--search\",id:\"search_box\"},/*#__PURE__*/React.createElement(\"i\",{className:\"material-icons\",id:\"search_icon\"},\"search\"),/*#__PURE__*/React.createElement(DebounceInput,{onBlur:function onBlur(){setTimeout(function(){return setSearchBox(false);},100);},onFocus:function onFocus(){return setSearchBox(true);},className:\"search-box\",type:\"text\",onChange:function onChange(e){return setSearch(e.target.value);},debounceTimeout:1000,placeholder:\"Pesquisar\"}),searchBox&&/*#__PURE__*/React.createElement(SearchBox,{loading:loading,results:results})),/*#__PURE__*/React.createElement(\"div\",{className:\"right-wrapper\"},/*#__PURE__*/React.createElement(\"div\",{className:\"shrink\"},/*#__PURE__*/React.createElement(\"div\",{className:\"header-main__content--buttons\"},/*#__PURE__*/React.createElement(\"div\",{className:\"button-wrapper\"},/*#__PURE__*/React.createElement(\"div\",{className:\"counter \".concat(cartCount===0?'counter-hidden':'')},/*#__PURE__*/React.createElement(\"p\",null,cartCount)),/*#__PURE__*/React.createElement(\"i\",{onClick:function onClick(){return setDialog(true);},className:\"material-icons\"},\"redeem\"),dialog&&/*#__PURE__*/React.createElement(Clipper,{handler:function handler(){return setDialog(false);}})),/*#__PURE__*/React.createElement(\"div\",{className:\"button-wrapper \".concat(authKey.length===0?'disabled':'')},/*#__PURE__*/React.createElement(\"div\",{className:\"counter \".concat(authKey.length===0?'counter-disabled':'',\" \").concat(notifCount===0?'counter-hidden':'')},/*#__PURE__*/React.createElement(\"p\",{className:\"notif-counter\"},notifCount)),/*#__PURE__*/React.createElement(Link,{onClick:function onClick(){authKey.length!==0&&dispatch(changeUrl('messages'));},to:\"/home\"},/*#__PURE__*/React.createElement(\"i\",{className:\"material-icons\"},\"notifications_none\")))),loading2?/*#__PURE__*/React.createElement(\"div\",{className:\"lds-dual-ring header-loader\"}):/*#__PURE__*/React.createElement(\"div\",{className:\"header-main__content--profile\"},/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){authKey.length!==0&&setSettings(true);},className:\"profile__btn\"},/*#__PURE__*/React.createElement(\"img\",{title:data.username,className:\"profile__btn--img\",src:\"\".concat(data.length===0?defaults.picture:data.picture),alt:\"Profile pic\"}))))))),settings&&/*#__PURE__*/React.createElement(Modal,null,/*#__PURE__*/React.createElement(SettingsDialog,{data:{'Perfil':'/home/arrangements','Configurações':'/account/edit','Sair':'/logout'},handler:function handler(){return setSettings(false);}})));}","map":{"version":3,"sources":["/home/fabricio7p/Documents/Projects/Ikebana/Frontend/src/components/Header/Header.js"],"names":["React","useState","useEffect","Link","useHistory","useLocation","useSelector","useDispatch","changeUrl","loadNotif","refreshAuth","DebounceInput","SettingsDialog","SearchBox","Modal","api","Clipper","Pages","CurrentUrl","active","pathname","slice","split","Header","dispatch","history","window","onscroll","shrinkOnScroll","document","body","scrollTop","documentElement","location","getElementById","style","height","top","transform","search","setSearch","searchBox","setSearchBox","results","setResults","loading","setLoading","loading2","setLoading2","commitSearch","method","url","data","response","console","log","side","setSide","innerWidth","toggleSidebar","display","includes","getElementsByClassName","dialog","setDialog","cartCount","state","shop","cart","length","allNotif","notifications","settings","setSettings","notifCount","setnotifCount","defaults","setData","authKey","auth","keys","hitApi","key","headers","refresh_key","onExpire","reload","interval","setInterval","clearInterval","filter","value","is_read","setTimeout","e","target","username","picture"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Link, useHistory, useLocation } from 'react-router-dom';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { changeUrl } from 'store/ducks/links';\nimport { loadNotif } from 'store/ducks/notifications';\nimport { refreshAuth } from 'store/ducks/auth';\nimport {DebounceInput} from 'react-debounce-input';\n\nimport SettingsDialog from '../aux/SettingsDialog/SettingsDialog';\nimport SearchBox from '../aux/SearchBox/SearchBox';\nimport Modal from '../aux/Modal';\nimport api from '../../services/api';\n\nimport './styles.scss';\n\nimport Clipper from '../aux/Clipper/Clipper';\n\n//Page names\nconst Pages = {\n    'explore' : 'Explorar',\n    'account' : 'Conta',\n    'home' : 'Perfil',\n    'lessons' : 'Aulas',\n    'lesson' : 'Aula'\n};\nconst CurrentUrl = () => {\n    let active = useLocation();\n    return active.pathname.slice(1).split('/')[0];\n}\n\nexport default function Header() {\n    const dispatch = useDispatch();\n    const history = useHistory();\n\n    //shrink on scroll\n    useEffect(() => {\n        window.onscroll = function() {shrinkOnScroll()};\n        const shrinkOnScroll = () => {\n            if (document.body.scrollTop > 80 || document.documentElement.scrollTop > 80) {\n\n            if (window.location.pathname !== '/motivation' &&\n                window.location.pathname !== '/register' &&\n                window.location.pathname !== '/login' &&\n                window.location.pathname !== '/forgot_pass' &&\n                window.location.pathname !== '/logout') {\n                    document.getElementById(\"header_main\").style.height=\"3.5em\"\n                    document.getElementById(\"menu_container\").style.top=\"4px\"\n                    document.getElementById(\"sidebar_menu\").style.transform=\"translateY(-1.5em)\"\n                }\n            }   else {\n            if (window.location.pathname !== '/motivation' &&\n                window.location.pathname !== '/register' &&\n                window.location.pathname !== '/login' &&\n                window.location.pathname !== '/forgot_pass' &&\n                window.location.pathname !== '/logout') {\n                    document.getElementById(\"menu_container\").style.top=\"16px\"\n                    document.getElementById(\"header_main\").style.height=\"5em\"\n                    document.getElementById(\"sidebar_menu\").style.transform=\"translateY(0)\"\n                }\n            }\n        }\n    })\n\n\n\n    //Search\n    const [search, setSearch] = useState(false);\n    const [searchBox, setSearchBox] = useState(false);\n    const [results, setResults] = useState([]);\n    const [loading, setLoading] = useState(false);\n    const [loading2, setLoading2] = useState(false);\n\n    const commitSearch = async () => {\n        setLoading(true)\n        try {\n            const response = await api({\n                method: 'post',\n                url: '/search',\n                data: {\n                    'string': search\n                }\n            })\n            setResults(response.data)\n        } catch(e) {\n            console.log(e)\n        } finally {\n            setLoading(false)\n        }\n    }\n\n    //hamburguer\n    const [side, setSide] = useState(true)\n\n    useEffect(() => {\n        window.innerWidth < 850 && setSide(false)\n    },[])\n\n    const toggleSidebar = () => {\n\n        if (window.innerWidth < 850) {\n            if (side) { \n                document.getElementById(\"main_sidebar\").style.transform=\"translateX(-220px)\"\n                document.getElementById(\"side-overlay\").style.display=\"none\";\n                setSide(false)\n            }\n            else {\n                document.getElementById(\"main_sidebar\").style.transform=\"translateX(0px)\"\n                document.getElementById(\"side-overlay\").style.display=\"block\";\n                setSide(true)\n            }\n\n        }\n\n        else {\n            if (side) { \n                document.getElementById(\"main_sidebar\").style.transform=\"translateX(-220px)\"\n                if (window.location.pathname.includes('explore')) {\n                    document.getElementsByClassName(\"prev\")[0].style.transform=\"translateX(10px)\"\n                }\n                setSide(false)\n            }\n            else {\n                document.getElementById(\"main_sidebar\").style.transform=\"translateX(0px)\"\n                if (window.location.pathname.includes('explore')) {\n                    document.getElementsByClassName(\"prev\")[0].style.transform=\"translateX(230px)\"\n                }\n                setSide(true)\n            }\n        }\n    }\n\n\n    //Buttons dialog\n    const [dialog, setDialog] = useState(false);\n\n    //Buttons counter indicator\n    const cartCount = useSelector(state => state.shop.cart.length);\n    const allNotif = useSelector(state => state.notifications.notifications)\n\n    //Profile button\n    const [settings, setSettings] = useState(false)\n\n    //Notif Counter\n    const [notifCount, setnotifCount] = useState(allNotif.length);\n\n    //Defaults\n    const defaults = useSelector(state => state.defaults.data)\n\n    //Data fetching\n    const [data, setData] = useState([])\n    const authKey = useSelector(state => state.auth.keys)\n\n    const hitApi = async (key) => {\n        setLoading2(true)\n        try{\n            const response = await api({\n                method: 'get',\n                url: '/user',\n                headers: {\n                    'Authorization': `Bearer ${key[0].key}`\n                }\n            })\n            dispatch(loadNotif(response.data.notifications))\n            setData(response.data)\n        } catch(e){\n            const refresh_key = authKey[0].refresh_key\n            const onExpire = await api({\n                method: 'get',\n                url: '/refresh',\n                headers: {\n                    'Authorization': `Bearer ${refresh_key}`\n                }\n            })\n            const { key } = onExpire.data\n            dispatch(refreshAuth({ key, refresh_key }))\n            window.location.reload()\n        } finally {\n            setLoading2(false)\n        }\n    }\n\n    useEffect(() => {\n      const interval = setInterval(() => {\n          authKey.length !== 0 && hitApi(authKey)\n      }, 100000);\n      return () => clearInterval(interval);\n    }, []);\n\n    useEffect(() => {\n        authKey.length !== 0 && hitApi(authKey)\n    }, [])\n\n    useEffect(() => {\n        setnotifCount(allNotif.filter((value) => {\n            return value.is_read === false\n        }).length)\n    })\n\n    useEffect(() => {\n        search &&\n            commitSearch()\n    }, [search])\n\n    return (\n        <>\n            <div onClick={toggleSidebar} id=\"side-overlay\"></div>\n            <div className=\"header-main\" id=\"header_main\">\n                <div className=\"menu-container\" id=\"menu_container\">\n                    <button onClick={toggleSidebar} id=\"hamburguer\"><i className=\"material-icons\">\n                        menu\n                    </i></button>\n                    <div className=\"sanguetsu-mark\">\n                        <img className=\"header-logo\" src={\"https://ikebana-app-content.s3-sa-east-1.amazonaws.com/static/mainlogo_transparent_notext.png\"} alt=\"logo\"/>\n                        <p className=\"logo-title\">SANGUETSU</p>\n                    </div>\n                </div>\n                <div className=\"header-main__content\" id=\"header_title\">\n                    <div className=\"header-main__content--title\">\n                        <div className=\"title-limiter\">\n                            <h1 className=\"page-title\" \n                                id=\"header_title\">{Pages[CurrentUrl()]}</h1>\n                        </div>\n                    </div>\n                    <div className=\"header-main__content--search\" id=\"search_box\">\n                        <i className=\"material-icons\" id=\"search_icon\">search</i>\n                        <DebounceInput onBlur={() => {\n                                setTimeout(() => setSearchBox(false), 100)\n                            }} onFocus={() => setSearchBox(true)} className=\"search-box\" type=\"text\"\n                        onChange={e => setSearch(e.target.value)} debounceTimeout={1000} placeholder=\"Pesquisar\"/>\n                        {\n                            searchBox &&\n                                <SearchBox loading={loading} results={results}/>\n                        }\n                    </div>\n                    <div className=\"right-wrapper\">\n                        <div className=\"shrink\">\n                            <div className=\"header-main__content--buttons\">\n                                <div className=\"button-wrapper\">\n                                    <div className={`counter ${ cartCount === 0 ?\n                                            'counter-hidden' : '' }`}>\n                                        <p>{cartCount}</p></div>\n                                    <i onClick={() => setDialog(true)} \n                                        className=\"material-icons\">redeem</i>\n                                    {\n                                        dialog &&\n                                            <Clipper handler={() => setDialog(false)} />\n                                    }\n                                </div>\n                                <div className={`button-wrapper ${authKey.length === 0 ? 'disabled' : ''}`}>\n                                    <div className={`counter ${ authKey.length === 0 ? 'counter-disabled' : '' } ${ notifCount === 0 ? 'counter-hidden' : '' }`}>\n                                        <p className=\"notif-counter\">{notifCount}</p></div>\n                                    <Link onClick={() => {authKey.length !== 0 &&\n                                            dispatch(changeUrl('messages'))\n                                            }} \n                                        to=\"/home\">\n                                        <i className=\"material-icons\">notifications_none</i>\n                                    </Link>\n                                </div>\n                            </div>\n                            {\n                                loading2 ? \n                                    <div className=\"lds-dual-ring header-loader\"></div>\n                                    :\n                                <div className=\"header-main__content--profile\">\n                                    <button onClick={() => {\n                                        authKey.length !== 0 &&\n                                            setSettings(true)\n                                    }} \n                                        className=\"profile__btn\">\n                                        <img title={data.username} className=\"profile__btn--img\" \n                                            src={`${data.length === 0 ? defaults.picture : data.picture}`}\n                                            alt=\"Profile pic\"/>\n                                    </button>\n                                </div>\n                            }\n                        </div>\n                    </div>\n                </div>\n            </div>\n            {\n                settings &&\n                    <Modal>\n                        <SettingsDialog data={{\n                            'Perfil': '/home/arrangements',\n                            'Configurações': '/account/edit',\n                            'Sair': '/logout'\n                        }} handler={() => setSettings(false)}/>\n                    </Modal>\n            }\n        </>\n    );\n}\n\n"]},"metadata":{},"sourceType":"module"}